<!-- <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/dashboard.css" />
    <script src="/js/dashboard.js"></script>
  </head>
  <body> -->
<!-- Navigation Bar -->
<!-- <nav class="navbar">
      <h1>Portfolio Dashboard</h1>
      <div class="navbar-links">
        <a href="/dashboard">Dashboard</a>
        <a href="/portfolios">Portfolios</a>
        <a href="/transactions">Transactions</a>
        <a href="/logout">Logout</a>
      </div>
    </nav> -->

<!-- Horizontal Line Chart -->
<!-- <div class="line-chart-container">
      <canvas id="investmentValueChart"></canvas>
    </div> -->

<!-- Top 3 Portfolios -->
<!-- <section class="top-portfolios">
      <h2>Top 3 Portfolios</h2>
      <div class="portfolio-cards">
        <div class="portfolio-card" th:each="portfolio : ${topPortfolios}">
          <h3 th:text="${portfolio.name}"></h3>
          <p>
            Total Invested: <span th:text="${portfolio.totalInvested}"></span>
          </p>
          <p>
            Current Value: <span th:text="${portfolio.currentValue}"></span>
          </p>
          <p>Returns: <span th:text="${portfolio.returns}"></span></p>
          <canvas
            class="mini-chart"
            id="miniChart"
            th:attr="id='miniChart'+${portfolio.id}"
          ></canvas>
        </div>
      </div>
    </section> -->

<!-- Key Metrics Section -->
<!-- <section class="metrics">
      <div class="metric-card">
        <h3>Latest 5 Transactions</h3>
        <ul>
          <li th:each="transaction : ${recentTransactions}">
            <span th:text="${transaction.transactionAt}"></span> -
            <span th:text="${transaction.stock.name}"></span>
            (<span th:text="${transaction.transactionType}"></span>): ₹<span
              th:text="${transaction.price}"
            ></span>
          </li>
        </ul>
      </div>

      <div class="metric-card">
        <h3>Top Performing Stocks</h3>
        <ul>
          <li th:each="stock : ${topPerformingStocks}">
            <span th:text="${stock.stock.name}"></span> - Returns:
            <span th:text="${stock.totalValue}"></span>%
          </li>
        </ul>
      </div>

      <div class="metric-card">
        <h3>Total Returns</h3>
        <p>Invested: ₹<span th:text="${totalInvested}"></span></p>
        <p>Value: ₹<span th:text="${currentValue}"></span></p>
        <p>Net Returns: <span th:text="${netReturns}"></span>%</p>
      </div>
    </section> -->

<!-- Donut Chart for Sector and Portfolio -->
<!-- <section class="donut-charts">
      <h2>Sector and Portfolio Breakdown</h2>
      <div class="donut-chart-container">
        <div>
          <h3>Sector-wise Distribution</h3>
          <canvas id="sectorWiseChart"></canvas>
        </div>
        <div>
          <h3>Portfolio-wise Distribution</h3>
          <canvas id="portfolioWiseChart"></canvas>
        </div>
      </div>
    </section> -->

<!-- Scripts -->
<!-- <script>
        // Chart.js configuration for the line chart
        const investmentValueChartCtx = document.getElementById('investmentValueChart').getContext('2d');
        new Chart(investmentValueChartCtx, {
            type: 'line',
            data: {
                labels: /* Labels (dates) */,
                datasets: [
                    {
                        label: 'Total Invested',
                        data: /* Total Invested Data */,
                        borderColor: 'blue',
                        fill: false,
                    },
                    {
                        label: 'Total Value',
                        data: /* Total Value Data */,
                        borderColor: 'green',
                        fill: false,
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    x: { title: { display: true, text: 'Date' } },
                    y: { title: { display: true, text: 'Amount (₹)' } }
                }
            }
        });

        // Similar configurations for mini charts and donut charts can be added here
    </script> -->
<!-- </body>
</html> -->

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" 
      >
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="title">Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* Ensure the main chart canvas takes 100% width */
      #investmentValueChart {
        width: 100% !important;
      }
    </style>
  </head>
  <body class="bg-gray-50 dark:bg-gray-900">
    <div id="content">
      <div class="grid grid-cols-12">
        <div class="xl:col-span-0"></div>
        <div class="col-span-12">
          
          <!-- Main Dashboard Content -->
          <div class="mt-2 space-y-6">
            <!-- Top Section: Line Chart -->
            <div class="w-full bg-white dark:bg-gray-800 p-4 rounded-lg shadow" style="height:100vh;">          
              <canvas id="investmentValueChart" class="w-full h-full"></canvas>
            </div>

            <!-- Middle Section: Top 3 Portfolio Cards -->
            <div class="w-full grid grid-cols-1 md:grid-cols-3 gap-4" style="height:100vh;">
              <div th:each="portfolio : ${topPortfolios}" class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                <div class="mb-2">
                  <h3 class="text-2xl font-bold text-gray-900 dark:text-white" th:text="${portfolio.name}"></h3>
                  <p class="text-sm text-gray-500 dark:text-gray-400" th:text="${portfolio.description}"></p>
                  <p class="text-sm text-gray-600 dark:text-gray-300">
                    Invested: ₹<span th:text="${portfolio.totalInvested}"></span>
                  </p>
                  <p class="text-sm text-gray-600 dark:text-gray-300">
                    Current: ₹<span th:text="${portfolio.totalValue}"></span>
                  </p>
                  <p class="text-sm font-semibold" 
                     th:class="${portfolio.totalValue - portfolio.totalInvested < 0 ? 'text-red-500' : 'text-green-500'}">
                     Return: <span th:text="${T(java.lang.String).format('%.2f', ((portfolio.totalValue - portfolio.totalInvested) * 100 / portfolio.totalInvested))}"></span>%
                  </p>
                </div>
                <div class="w-full h-20">
                  <canvas th:attr="id='miniChart' + ${portfolio.id}" class="w-full h-full"></canvas>
                </div>
                <div class="mt-2 text-center">
                  <a th:href="@{'/portfolios/' + ${portfolio.id}}" 
                     class="px-4 py-2 rounded bg-blue-700 text-white text-sm hover:bg-blue-800 transition-colors duration-300">
                     View Details
                  </a>
                </div>
              </div>
            </div>

            <!-- Bottom Section: Insight Cards -->
            <div class="w-full grid grid-cols-1 md:grid-cols-3 gap-4" style="height:25vh;">
              <!-- Donut Chart for Portfolio Distribution -->
              <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 text-center">
                  Portfolio Distribution
                </h3>
                <canvas id="portfolioDonutChart" class="w-full h-40"></canvas>
                <div class="text-center mt-2">
                  <a href="/portfolios" class="text-blue-600 dark:text-blue-400 hover:underline">View All Portfolios</a>
                </div>
              </div>
              <!-- Donut Chart for Stock Distribution -->
              <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 text-center">
                  Stock Distribution
                </h3>
                <canvas id="stockDonutChart" class="w-full h-40"></canvas>
                <div class="text-center mt-2">
                  <a href="/stocks" class="text-blue-600 dark:text-blue-400 hover:underline">View All Stocks</a>
                </div>
              </div>
              <!-- Donut Chart for Total Profit/Loss -->
              <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2 text-center">
                  Total Profit/Loss
                </h3>
                <canvas id="profitLossDonutChart" class="w-full h-40"></canvas>
                <div class="text-center mt-2">
                  <a href="/transactions" class="text-blue-600 dark:text-blue-400 hover:underline">View Transactions</a>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Chart.js Scripts for Graphs -->
    <script th:inline="javascript">
      // Line Chart for Total Investment vs. Total Value Over Time
      console.log("Graph Data: ", /*[[${graphData}]]*/ {});
      const lineCtx = document.getElementById('investmentValueChart').getContext('2d');
      // Replace the following with your dynamic data or bind via Thymeleaf (e.g., [[${graphData}]])
      console.log("Canvas Found:", lineCtx);
      var graphData = /*[[${graphData}]]*/ {};

      // graphData = JSON.parse(JSON.stringify(graphData)); // Ensures proper parsing

      console.log("Graph Data Parsed: ", graphData);
      console.log("Dates: ", graphData.dates); // Should log an array


      // console.log("Graph Dates: ", graphData);
      new Chart(lineCtx, {
          type: 'line',
          data: {
              labels: graphData.dates,
              datasets: [
                  {
                      label: 'Total Invested',
                      data: graphData.totalInvestments,
                      borderColor: 'blue',
                      fill: false,
                      tension: 0.3
                  },
                  {
                      label: 'Total Value',
                      data: graphData.totalValues,
                      borderColor: 'green',
                      fill: false,
                      tension: 0.3
                  }
              ]
          },
          options: {
              responsive: true,
              scales: {
                  x: { title: { display: true, text: 'Date' } },
                  y: { title: { display: true, text: 'Amount (₹)' } }
              }
          }
      });

      // Donut Chart for Portfolio Distribution
      const portfolioDonutCtx = document.getElementById('portfolioDonutChart').getContext('2d');
      const portfolioDonutData = {
          labels: ['Portfolio A', 'Portfolio B', 'Portfolio C'],
          datasets: [{
              data: [40, 35, 25],
              backgroundColor: ['#4CAF50', '#2196F3', '#FFC107']
          }]
      };
      new Chart(portfolioDonutCtx, {
          type: 'doughnut',
          data: portfolioDonutData,
          options: { responsive: true }
      });

      // Donut Chart for Stock Distribution
      const stockDonutCtx = document.getElementById('stockDonutChart').getContext('2d');
      const stockDonutData = {
          labels: ['Stock X', 'Stock Y', 'Stock Z'],
          datasets: [{
              data: [50, 30, 20],
              backgroundColor: ['#FF5722', '#9C27B0', '#03A9F4']
          }]
      };
      new Chart(stockDonutCtx, {
          type: 'doughnut',
          data: stockDonutData,
          options: { responsive: true }
      });

      // Donut Chart for Total Profit/Loss
      const profitLossDonutCtx = document.getElementById('profitLossDonutChart').getContext('2d');
      const profitLossDonutData = {
          labels: ['Profit', 'Loss'],
          datasets: [{
              data: [70, 30],
              backgroundColor: ['#4CAF50', '#F44336']
          }]
      };
      new Chart(profitLossDonutCtx, {
          type: 'doughnut',
          data: profitLossDonutData,
          options: { responsive: true }
      });

      // Mini Charts for Portfolio Cards can be initialized similarly using each card's canvas element,
      // which is identified by an id like "miniChart{portfolio.id}"
    </script>
  </body>
</html>


